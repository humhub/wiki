humhub.module("wiki",function(i,t,s){function e(t,e,i){c.push({$node:t,$trigger:e,condition:i})}var n=t("ui.widget").Widget,r=t("event"),l=t("ui.view"),a=t("client"),o=t("ui.loader"),c=[],t=n.extend();t.prototype.init=function(){s(window).off("scroll.wiki").on("scroll.wiki",function(){s.each(c,function(t,e){var i=s(window).scrollTop()+l.getContentTop()>e.$trigger.offset().top,n=!e.condition||e.condition.call(),i=i&&n,n=e.$node.data("menu-top"),r=n&&n.length?n.height():0,a={position:"relative",top:"0",left:"initial"},o="flex"===e.$node.parent().css("display")?"fixed":"sticky";i&&(a.position=o,a.top=l.getContentTop()+r+"px","fixed"==o)&&(a.left=e.$node.offset().left),e.$node.css(a),r&&(i&&(a.top=parseInt(a.top)-r+"px"),n.css(a))})});var t=this.$.find(".wiki-menu");t.length&&e(t,this.$,{call:()=>s(window).width()<768})},t.prototype.loader=function(t){var e=this.$.find(".wiki-menu");!1===t?o.reset(e):o.set(e,{size:"8px",css:{padding:0,width:"60px"}})},t.prototype.reloadEntry=function(t){var e;if(t)return(e=t.parent('[data-ui-widget="wiki.Content"]')).loader(),a.get(t.data("entry-url")).then(function(t){return t.output&&(e.$.html(t.output),e.$.find("[data-ui-widget]").each(function(){n.instance(s(this))})),t}).catch(function(t){i.log.error(t,!0)}).finally(function(){e.loader(!1)})};i.export({Content:t,toAnchor:function(t){t=s("#"+s.escapeSelector(t.substr(1,t.length)));t.length&&(s("html, body").animate({scrollTop:t.offset().top-l.getContentTop()},200),s(".current-anchor-header").removeClass("current-anchor-header"),t.addClass("current-anchor-header"),history)&&history.replaceState&&history.replaceState(null,null,"#"+t.attr("id"))},revertRevision:function(t){a.post(t).then(function(t){a.redirect(t.redirect),i.log.success("saved")}).catch(function(t){i.log.error(t,!0)})},actionDelete:function(t){a.pjax.post(t)},registerStickyElement:e,unload:function(){c=[],s(window).off("scroll.wiki"),r.off("humhub:content:afterMove.wiki")}})}),humhub.module("wiki.Page",function(e,t,h){var i=t("ui.widget").Widget,p=t("wiki"),t=i.extend(),n=(t.prototype.init=function(){var t=this;this.$.find("#wiki-page-richtext").on("afterInit",function(){h(this).data("inited-richtext",!0),t.$.data("diff")?n(h(t.$.data("diff")).find("#wiki-page-richtext"),h(this)):t.$.fadeIn("slow"),t.buildIndex(),t.initAnchor(),t.initHeaderEditIcons()})},t.print=function(){window.print()},t.prototype.initAnchor=function(){window.location.hash&&p.toAnchor(window.location.hash),h(".wiki-content").find(".header-anchor").on("click",function(t){t.preventDefault(),p.toAnchor(h(this).attr("href"))})},t.prototype.initHeaderEditIcons=function(){const i=this.data("edit-url");void 0!==i&&(this.$.html(this.$.html().replace(/(<h([1-3]).*?>.+?<\/h\2>([\s\S]*?(?=<h[1-3]|$)))/gi,'<div class="wiki-page-header-wrapper">$1</div>')),this.$.find("h1,h2,h3").each(function(){var t=h(this).find("a.header-anchor"),e='<a href="'+i+'" class="header-edit-link"><i class="fa fa-pencil"></i></a>';t.length?t.before(e+" "):h(this).append(" "+e)}))},t.prototype.buildIndex=function(){var o=h('<ul class="nav nav-pills nav-stacked">'),t=h('<li><a href="#">'+p.text("pageindex")+"</li></a>").on("click",function(t){t.preventDefault();t=h(this).siblings(":not(.nav-divider)");t.first().is(":visible")?t.hide():t.show()}),s=(o.append(t),!1),l=1,c=[],d=this.$.find("#wiki-page-richtext h1").length?1:2,t=this.$.find("#wiki-page-richtext h3").length<=e.config.tocMaxH3;this.$.find("#wiki-page-richtext").find("h1,h2"+(t?",h3":"")).each(function(){s=!0;var t=h(this).clone(),e=t.find(".header-anchor").clone(),i=(e.show(),t.find(".header-anchor").remove(),t.text());if(i&&i.trim().length){for(var n=1,r=(t.is("h2")?n=2==d?1:2:t.is("h3")&&(n=2==d?2:3),n!==l&&(l<n&&(c[n]=0),l=n),void 0===c[l]&&(c[l]=0),c[l]++,""),a=1;a<=l;a++)r+=(1<a?".":"")+(c[a]??1);e.text(i).prepend("<span>"+r+"</span>");t=h("<li>");t.addClass("wiki-page-index-section wiki-page-index-section-level"+n),e.on("click",function(t){t.preventDefault(),p.toAnchor(e.attr("href"))}),t.append(e),o.append(t)}}),s&&((t=this.$.find("h1, h2"+(t?",h3":"")).first()).length?t.before(o):this.$.prepend(o),o.wrap('<div class="wiki-page-index"></div>'))},function(i,n){var r=setInterval(function(){var t,e;i.length&&!i.data("inited-richtext")||(e=new RegExp('(<img .+?)data-ui-gallery=".+?"(.+?>)',"g"),t=i.length?i.html().replace(e,"$1$2"):"",e=n.length?n.html().replace(e,"$1$2"):"",n.html(htmldiff(t,e)),n.parent().fadeIn("slow"),clearInterval(r))},100)});e.export=t}),humhub.module("wiki.Form",function(t,e,i){var n=e("ui.widget").Widget,r=e("wiki"),a=e("ui.additions"),e=n.extend();e.prototype.init=function(){var t=this;this.getRichtext().on("init",function(){r.registerStickyElement(t.getRichtextMenu(),t.getRichtext())}),t.$.find("div.checkbox").each(function(){var t=i(this),e=t.find("[type=checkbox][title]");e.length&&t.find("label").addClass("tt").attr("title",e.attr("title")),a.apply(t,"tooltip")}),t.options.isCategory&&i("#wikipage-is_category").click(function(){var e=i(this);if(e.is(":not(:checked)"))return modal.confirm({body:t.options.changeCategoryConfirm}).then(function(t){t||e.prop("checked",!0)})})},e.prototype.getRichtextMenu=function(){return this.$menu||(this.$menu=this.$.find(".ProseMirror-menubar")),this.$menu},e.prototype.getRichtext=function(){return this.$richtext||(this.$richtext=this.$.find(".ProsemirrorEditor")),this.$richtext},e.prototype.backOverwriting=function(){i('input[type=hidden][name="PageEditForm[backOverwriting]"]').val(1),i('form[data-ui-widget="wiki.Form"]').submit()},e.prototype.compareOverwriting=function(t){var e=this.$,i=e.attr("action");e.attr("target","_blank").attr("action",t.$trigger.data("action-click-url")).submit(),setTimeout(function(){e.attr("action",i),e.removeAttr("target")},500)},e.submit=function(){i('form[data-ui-widget="wiki.Form"]').submit()},t.export=e}),humhub.module("wiki.CategoryListView",function(s,t,a){var e=t("ui.widget").Widget,l=t("client"),i=t("ui.view"),t=e.extend();t.prototype.indent={default:12,level:17},t.prototype.init=function(){this.initFoldingSubpages(),this.initSorting(),this.initPageTitleLink()},t.prototype.initFoldingSubpages=function(){this.$.on("click",".fa-caret-down, .fa-caret-right",function(){var e=a(this),i=e.parent().parent().siblings(".wiki-page-list");i.slideToggle("fast",function(){var t=i.is(":visible")?"fa-caret-down":"fa-caret-right",t=(e.removeClass("fa-caret-down fa-caret-right").addClass(t),e.closest(".wiki-category-list-item[data-page-id]").data("page-id"));t&&l.get(s.config.updateFoldingStateUrl,{data:{categoryId:t,state:i.is(":visible")?0:1}})})})},t.prototype.initSorting=function(){this.$.find(".wiki-page-list").add(this.$).sortable({delay:i.isSmall()?250:null,handle:".drag-icon",cursor:"move",connectWith:".wiki-page-list",items:"[data-page-id]",helper:"clone",placeholder:"ui-sortable-drop-area",tolerance:"pointer",sort:a.proxy(this.fixSort,this),create:a.proxy(this.fixer,this),change:a.proxy(this.updatePlaceholderStyle,this),over:a.proxy(this.overList,this),out:a.proxy(this.clearDroppablePlaceholder,this),start:a.proxy(this.startDropItem,this),stop:a.proxy(this.stopDropItem,this),update:a.proxy(this.dropItem,this)})},t.prototype.initPageTitleLink=function(){this.$.on("click",".page-title",function(t){var e;t.target!==this&&!a(t.target).hasClass("page-title-text")||((e=a(this).next("ul.wiki-page-list")).length&&e.is(":hidden")&&a(this).find(".fa-caret-right").trigger("click"),t.target!==this)||a(this).find("a.page-title-text").trigger("click")})},t.prototype.fixSort=function(t,e){this.fixPlaceholderPositionY(t,e),this.fixPlaceholderPositionX(t,e)},t.prototype.fixPlaceholderPositionX=function(t,e){var i=e.placeholder.parent().children("li:not(.ui-sortable-helper)").length,i=1<i&&i-1===e.placeholder.index(),n=e.position.left+e.helper.find(".drag-icon").position().left,r=parseInt(e.placeholder.parent().prev(".page-title").css("padding-left")),n=n-this.indent.level<r;i&&n&&(e.placeholder.parent().parent().after(e.placeholder),this.updateTargetStyle(e.placeholder),this.updatePlaceholderStyle())},t.prototype.fixPlaceholderPositionY=function(t,e){t=t.pageY-e.placeholder.offset().top;Math.abs(t)>e.item.outerHeight()/2&&(0<t?e.placeholder.next().after(e.placeholder):e.placeholder.prev().before(e.placeholder))},t.prototype.updatePlaceholderStyle=function(){var t=a(".ui-sortable-drop-area"),e=this.$.is(t.parent())?0:parseInt(t.parent().prev(".page-title").css("padding-left"))+2*this.indent.level-this.indent.default-8;t.css("margin-left",e+"px")},t.prototype.overList=function(t,e){this.updateTargetStyle(e.placeholder)},t.prototype.updateTargetStyle=function(t){this.clearDroppablePlaceholder();var e=t.closest(".wiki-page-list").parent();e.addClass("wiki-current-target-category").parents(".wiki-category-list-item:eq(0)").addClass("wiki-parent-target-category"),e.is(":hidden")&&e.closest(".wiki-parent-target-category").addClass("wiki-current-target-category"),0===t.index()&&1<t.parent().children("li").length&&e.addClass("wiki-current-target-category-over")},t.prototype.clearStyle=function(t){return a("."+t).removeClass(t),this},t.prototype.clearDroppablePlaceholder=function(){return this.clearStyle("wiki-current-target-category").clearStyle("wiki-current-target-category-over").clearStyle("wiki-parent-target-category")},t.prototype.startDropItem=function(t,e){e.item.show().addClass("wiki-current-dropping-page"),e.helper.height(e.item.children(".page-title").outerHeight()),this.clearStyle("wiki-list-item-selected"),this.$.addClass("wiki-page-is-dropping"),a(".wiki-page-list").each(function(){!a(this).is(":hidden")&&0!==a(this).find("li").length||a(this).addClass("wiki-page-list-droppable-target")})},t.prototype.stopDropItem=function(t,e){this.clearDroppablePlaceholder().clearStyle("wiki-current-dropping-page").clearStyle("wiki-page-list-droppable-target").clearStyle("wiki-page-is-dropping"),a(".wiki-category-list-item .page-current").parent().addClass("wiki-list-item-selected"),void 0!==e&&this.fixListIndent(e.item)},t.prototype.updateIcons=function(){const n=this,r=void 0!==n.data("icon-page");a(".page-title").each(function(){var t,e=a(this).next("ul.wiki-page-list").find("li.wiki-category-list-item").length,i=a(this).hasClass("page-is-category");e&&!i&&(a(this).addClass("page-is-category"),t='<i class="'+n.data("icon-category")+'"></i> ',r?a(this).find("."+n.data("icon-page").replace(" ",".")).after(t).remove():a(this).find(".page-title-text").before(t)),!e&&i&&(a(this).removeClass("page-is-category"),t=a(this).find("."+n.data("icon-category").replace(" ",".")),r&&t.after('<i class="'+n.data("icon-page")+'"></i>'),t.remove())})},t.prototype.fixListIndent=function(t){var e=t.closest(".wiki-page-list");if(e.length){const i=this;e=e.prev(".page-title"),e=e.length?parseInt(e.css("padding-left"))+this.indent.level:this.indent.default;t.children(".page-title").css("padding-left",e+"px"),t.children(".wiki-page-list").children("li").each(function(){i.fixListIndent(a(this))})}},t.prototype.fixer=function(){var t="wiki-category-list-sort-fixer",e=this.$.children("."+t);return e.length||(e=a("<li data-page-id>").addClass(t),this.$.append(e)),e},t.prototype.refreshFixer=function(){this.$.append(this.fixer())},t.prototype.dropItem=function(t,e){const i=e.item;e=i.data("page-id");const n=i.children(".page-title");var r=i.parents(".wiki-category-list-item").first(),r=r.length?r.data("page-id"):null;let a=i.index();var o=this.fixer().index(),o=(a>o&&i.parent().is(this.$)&&(a=o,this.refreshFixer()),{"ItemDrop[id]":e,"ItemDrop[targetId]":r,"ItemDrop[index]":a});this.stopDropItem(),this.updateIcons(),n.addClass("wiki-page-dropped"),l.post(this.options.dropUrl,{data:o}).then(function(t){t.success||i.closest(".category_list_view, .wiki-page-list").sortable("cancel"),n.removeClass("wiki-page-dropped")}).catch(function(t){s.log.error(t,!0),i.closest(".category_list_view, .wiki-page-list").sortable("cancel"),n.removeClass("wiki-page-dropped")})},s.export=t}),humhub.module("wiki.linkExtension",function(o,t,s){var e=t("ui.richtext.prosemirror"),i=t("ui.widget").Widget,l=t("ui.modal"),c=t("client"),n=e.api.plugin.markdown,r=e.api.menu,t=e.api.plugin,a=e.api.state.NodeSelection,d=function(t,e,i,n,r){h(t,e,i,n,r.attrs)},h=function(i,t,e,n,r){s(".field-wikipagesearch-anchor").hide(),s("#wikipagesearch-anchor").empty();var a=l.get("#wikiLinkModal");s("#wikipagesearch-title").off("change.extract").on("change.extract",function(){s("#wikipagesearch-title").val()&&(s("#wikipagesearch-label").val(s("#wikipagesearch-title").select2("data")[0].text),c.get(o.config.extractTitleUrl,{data:{id:s("#wikipagesearch-title").val()}}).then(function(t){var e,i={};t.response&&t.response.length?(e=s("<option>").attr({value:""}).text(""),s("#wikipagesearch-anchor").append(e),t.response.forEach(function(t){var e=f(p(t),i),e=s("<option>").attr({value:e}).text(t);s("#wikipagesearch-anchor").append(e)}),r&&r.anchor&&s("#wikipagesearch-anchor").val(r.anchor),s(".field-wikipagesearch-anchor").show()):s(".field-wikipagesearch-anchor").hide()}).catch(function(t){o.log.error(t)}))}),(r&&r.wikiId?s("#wikipagesearch-title").val(r.wikiId):s("#wikipagesearch-title").val(1)).trigger("change"),r&&r.label?s("#wikipagesearch-label").val(r.label):s("#wikipagesearch-label").val(t.doc.cut(t.selection.from,t.selection.to).textContent),a.$.off("submitted").on("submitted",function(){var t=s("#wikipagesearch-title option:selected"),e=s("#wikipagesearch-label"),t={title:t.text(),wikiId:s("#wikipagesearch-title").val(),anchor:s("#wikipagesearch-anchor").val(),label:e.val()};a.close(),n.dispatch(n.state.tr.replaceSelectionWith(i.schema.nodes.wiki.createAndFill(t))),n.focus()}),a.$.on("shown.bs.modal",function(t){s(".ProsemirrorEditor.fullscreen").css("z-index",s(t.target).css("z-index")-10)}),a.show()},p=function(t){return encodeURIComponent(String(t).trim().toLowerCase().replace(/\s+/g,"-"))},f=function(t,e){for(var i=t,n=2;Object.prototype.hasOwnProperty.call(e,i);)i=t+"-"+n++;return e[i]=!0,i},e=(t.registerPlugin({id:"wiki",schema:{nodes:{wiki:{sortOrder:1001,inline:!0,group:"inline",marks:"em strong strikethrough",attrs:{wikiId:{default:""},anchor:{default:""},title:{default:""},label:{default:""}},inclusive:!1,parseDOM:[{tag:"span[data-wiki-page]",getAttrs:function(t){return{wikiId:t.getAttribute("data-wiki-page"),title:t.getAttribute("title"),label:t.textContent}}}],toDOM:function(t){return["span",{title:"#"===t.attrs.wikiId?o.text("pageNotFound"):t.attrs.title,"data-wiki-page":t.attrs.wikiId},t.attrs.label]},parseMarkdown:{node:"wiki",getAttrs:function(t){var e,i=t.attrGet("wikiId"),n="";return 0<=i.indexOf("#")&&(i=(e=i.split("#"))[0],n=e[1]),{label:t.attrGet("label"),title:t.attrGet("title"),wikiId:i,anchor:n}}},toMarkdown:function(t,e){var i="wiki:"+e.attrs.wikiId;t.write("["+t.esc(e.attrs.label)+"]("+t.esc(i)+' "'+e.attrs.anchor+'")')}}}},registerMarkdownIt:function(t){t.inline.ruler.before("link","wiki",n.createLinkExtension("wiki",{labelAttr:"label",hrefAttr:"wikiId",titleAttr:"title"})),t.renderer.rules.wiki=function(t,e){t=t[e];return t.attrGet("label")?(e="#"===t.attrGet("wikiId"),s("<div>").append(s("<a>").attr({href:t.attrGet("wikiId"),title:e?o.text("pageNotFound"):t.attrGet("title"),"data-wiki-page":e?"#":""}).text(t.attrGet("label"))).html()):""}},menu:function(t){return[{id:"wiki",node:"wiki",group:"marks",item:((n=t).schema.marks.wiki,t={title:n.translate("Add or remove Wiki link"),icon:{width:32,height:32,path:"M30.212 7.3c0 0.1-0.031 0.194-0.094 0.281-0.063 0.081-0.131 0.125-0.212 0.125-0.625 0.063-1.137 0.263-1.531 0.6-0.4 0.338-0.806 0.994-1.225 1.95l-6.45 14.544c-0.044 0.137-0.163 0.2-0.356 0.2-0.15 0-0.269-0.069-0.356-0.2l-3.619-7.563-4.162 7.563c-0.088 0.137-0.2 0.2-0.356 0.2-0.188 0-0.306-0.069-0.369-0.2l-6.331-14.537c-0.394-0.9-0.813-1.531-1.25-1.887s-1.050-0.581-1.831-0.662c-0.069 0-0.131-0.037-0.188-0.106-0.063-0.069-0.087-0.15-0.087-0.244 0-0.237 0.069-0.356 0.2-0.356 0.562 0 1.156 0.025 1.775 0.075 0.575 0.050 1.112 0.075 1.619 0.075 0.513 0 1.125-0.025 1.825-0.075 0.731-0.050 1.381-0.075 1.95-0.075 0.137 0 0.2 0.119 0.2 0.356s-0.044 0.35-0.125 0.35c-0.563 0.044-1.012 0.188-1.338 0.431s-0.487 0.563-0.487 0.963c0 0.2 0.069 0.456 0.2 0.756l5.231 11.825 2.975-5.613-2.769-5.806c-0.5-1.037-0.906-1.706-1.225-2.006s-0.806-0.481-1.456-0.55c-0.063 0-0.113-0.037-0.169-0.106s-0.081-0.15-0.081-0.244c0-0.237 0.056-0.356 0.175-0.356 0.563 0 1.081 0.025 1.556 0.075 0.456 0.050 0.938 0.075 1.456 0.075 0.506 0 1.037-0.025 1.606-0.075 0.581-0.050 1.156-0.075 1.719-0.075 0.137 0 0.2 0.119 0.2 0.356s-0.038 0.35-0.125 0.35c-1.131 0.075-1.694 0.4-1.694 0.963 0 0.25 0.131 0.644 0.394 1.175l1.831 3.719 1.825-3.4c0.25-0.481 0.381-0.887 0.381-1.213 0-0.775-0.563-1.188-1.694-1.237-0.1 0-0.15-0.119-0.15-0.35 0-0.088 0.025-0.162 0.075-0.237s0.1-0.112 0.15-0.112c0.406 0 0.9 0.025 1.494 0.075 0.563 0.050 1.031 0.075 1.394 0.075 0.262 0 0.644-0.025 1.15-0.063 0.637-0.056 1.175-0.088 1.606-0.088 0.1 0 0.15 0.1 0.15 0.3 0 0.269-0.094 0.406-0.275 0.406-0.656 0.069-1.188 0.25-1.587 0.544s-0.9 0.963-1.5 2.013l-2.444 4.475 3.288 6.7 4.856-11.294c0.169-0.412 0.25-0.794 0.25-1.137 0-0.825-0.563-1.263-1.694-1.319-0.1 0-0.15-0.119-0.15-0.35 0-0.237 0.075-0.356 0.225-0.356 0.413 0 0.9 0.025 1.469 0.075 0.525 0.050 0.962 0.075 1.313 0.075 0.375 0 0.8-0.025 1.288-0.075 0.506-0.050 0.962-0.075 1.369-0.075 0.125 0 0.188 0.1 0.188 0.3z"},sortOrder:410,enable:function(t){return r.canInsert(t,n.schema.nodes.wiki)},run:function(t,e,i){t.selection instanceof a&&t.selection.node.type===n.schema.nodes.wiki?d(n,t,e,i,t.selection.node):h(n,t,e,i)}},new r.MenuItem(t))}];var n}}),t.registerPreset("wiki",{extend:"document",callback:function(t){t("wiki","wiki",{before:"link"})}}),i.extend());o.initOnPjaxLoad=!0,o.export({SearchInput:e,setEditorLink:function(t){var e=l.get("#wikiLinkModal");e.$.trigger("submitted"),e.close()}})}),humhub.module("wiki.History",function(i,t,r){function a(t){r("input[type=radio][name=revision_"+o[t]+"]").prop("checked",!1)}var e=t("ui.widget").Widget,n=t("client"),t=e.extend(),o=[],s="input[type=radio][name^=revision_]";t.prototype.init=function(){r(s).each(function(t){o[t]=r(this).val(),t<2&&r(this).prop("checked",!0)});var e=0,i=1,n="top";this.$.on("click",s,function(){var t=r(s).index(r("[value="+r(this).val()+"]"));"top"===n&&e<t||i<t&&e<t?(a(i),n="bottom",i=t):(a(e),n="top",e=t)})},t.compare=function(){var t=i.config.wikiDiffUrl,e=2;r(s+":checked").each(function(){e&&(t=(t+=-1<t.indexOf("?")?"&":"?")+"revision"+e+"="+r(this).val(),e--)}),n.pjax.redirect(t)},i.export=t}),humhub.module("wiki.Sidebar",function(t,e,i){e=e("ui.widget").Widget.extend();e.prototype.init=function(){const e=this,i=this.$,n=i.parent(),t=i.next(),r=i.outerWidth()-i.width()+t.outerWidth()-t.width();i.resizable({minWidth:.25*n.width(),maxWidth:.75*n.width(),handles:"e",resize:function(){t.width(n.width()-i.width()-r)},stop:function(){var t=(i.outerWidth()/n.outerWidth()*100).toFixed(2);e.setWidth(t),e.setCache(t)}})},e.prototype.setWidth=function(t){t&&(this.$.css("width",t+"%"),this.$.next().css("width",100-t+"%"))},e.prototype.getCache=function(){var t=localStorage.getItem(this.cacheName());return t?JSON.parse(t):{}},e.prototype.setCache=function(t){var e=this.getCache();e[this.key()]=t,localStorage.setItem(this.cacheName(),JSON.stringify(e))},e.prototype.cacheName=function(){return this.$.data("resizable-key")},e.prototype.key=function(){return this.$.data("container-id")},t.export=e}),humhub.module("wiki.ListTable",function(t,e,i){e=e("ui.widget").Widget.extend();e.prototype.init=function(){this.$.find(".table > tbody > tr > td").on("click",function(t){"A"!==i(t.target).prop("tagName")&&(t=i(this).find(".wiki-page-list-row-title a")).length&&(location.href=t.attr("href"))})},t.export=e}),function(){var t,s=function(t){return">"===t},l=function(t){return"<"===t},c=function(t){return/^\s+$/.test(t)},o=function(t){return/^\s*<[^>]+>\s*$/.test(t)},d=function(t){return!o(t)},_=function(t,e,i){this.start_in_before=t,this.start_in_after=e,this.length=i,this.end_in_before=this.start_in_before+this.length-1,this.end_in_after=this.start_in_after+this.length-1},n=function(t){for(var e,i="char",n="",r=[],a=0,o=t.length;a<o;a++)switch(e=t[a],i){case"tag":s(e)?(r.push(n+=">"),n="",i=c(e)?"whitespace":"char"):n+=e;break;case"char":l(e)?(n&&r.push(n),n="<",i="tag"):/\s/.test(e)?(n&&r.push(n),n=e,i="whitespace"):/[\w\#@]+/i.test(e)?n+=e:(n&&r.push(n),n=e);break;case"whitespace":l(e)?(n&&r.push(n),n="<",i="tag"):c(e)?n+=e:(n&&r.push(n),n=e,i="char");break;default:throw new Error("Unknown mode "+i)}return n&&r.push(n),r},h=function(t,e,i,n,r,a,o){for(var s,l,c,d,h,p,f,u,g,w=n,k=a,v=0,m={},y=s=g=n,x=r;g<=x?s<x:x<s;y=g<=x?++s:--s){for(u={},c=0,d=(h=i[t[y]]).length;c<d;c++)if(!((l=h[c])<a)){if(o<=l)break;null==m[l-1]&&(m[l-1]=0),f=m[l-1]+1,v<(u[l]=f)&&(w=y-f+1,k=l-f+1,v=f)}m=u}return p=0!==v?new _(w,k,v):p},p=function(t,e,i,n,r,a,o,s){var l;return null!=(l=h(t,0,i,n,r,a,o))&&(n<l.start_in_before&&a<l.start_in_after&&p(t,e,i,n,l.start_in_before,a,l.start_in_after,s),s.push(l),l.end_in_before<=r)&&l.end_in_after<=o&&p(t,e,i,l.end_in_before+1,r,l.end_in_after+1,o,s),s},r=function(t){var e,i,n,r,a,o;if(null==t.find_these)throw new Error("params must have find_these key");if(null==t.in_these)throw new Error("params must have in_these key");for(n={},e=0,r=(a=t.find_these).length;e<r;e++)for(n[o=a[e]]=[],i=t.in_these.indexOf(o);-1!==i;)n[o].push(i),i=t.in_these.indexOf(o,i+1);return n},v=function(t,e){var i=[],n=r({find_these:t,in_these:e});return p(t,e,n,0,t.length,0,e.length,i)},a=function(e,t){var i,n,r,a,o,s,l,c,d,h,p,f,u,g,w,k;if(null==e)throw new Error("before_tokens?");if(null==t)throw new Error("after_tokens?");for(w=g=0,u=[],i={"false,false":"replace","true,false":"insert","false,true":"delete","true,true":"none"},(p=v(e,t)).push(new _(e.length,t.length,0)),a=r=0,c=p.length;r<c;a=++r)"none"!==(n=i[[w===(h=p[a]).start_in_before,g===h.start_in_after].toString()])&&u.push({action:n,start_in_before:w,end_in_before:"insert"!==n?h.start_in_before-1:void 0,start_in_after:g,end_in_after:"delete"!==n?h.start_in_after-1:void 0}),0!==h.length&&u.push({action:"equal",start_in_before:h.start_in_before,end_in_before:h.end_in_before,start_in_after:h.start_in_after,end_in_after:h.end_in_after}),w=h.end_in_before+1,g=h.end_in_after+1;for(k=[],l={action:"none"},o=function(t){return"equal"===t.action&&t.end_in_before-t.start_in_before==0&&/^\s$/.test(e.slice(t.start_in_before,+t.end_in_before+1||9e9))},s=0,d=u.length;s<d;s++)o(f=u[s])&&"replace"===l.action||"replace"===f.action&&"replace"===l.action?(l.end_in_before=f.end_in_before,l.end_in_after=f.end_in_after):(k.push(f),l=f);return k},f=function(t,e,i){for(var n,r,a=void 0,o=r=0,s=(e=e.slice(t,+e.length+1||9e9)).length;r<s&&(!0===(n=i(e[o]))&&(a=o),!1!==n);o=++r);return null!=a?e.slice(0,+a+1||9e9):[]},u=function(t,e){for(var i,n="",r=0,a=e.length;!(a<=r||(r+=(i=f(r,e,d)).length,0!==i.length&&(n+="<"+t+">"+i.join("")+"</"+t+">"),a<=r));)r+=(i=f(r,e,o)).length,n+=i.join("");return n},g={equal:function(t,e,i){return e.slice(t.start_in_before,+t.end_in_before+1||9e9).join("")},insert:function(t,e,i){i=i.slice(t.start_in_after,+t.end_in_after+1||9e9);return u("ins",i)},delete:function(t,e,i){e=e.slice(t.start_in_before,+t.end_in_before+1||9e9);return u("del",e)},replace:function(t,e,i){return g.delete(t,e,i)+g.insert(t,e,i)}},w=function(t,e,i){for(var n,r="",a=0,o=i.length;a<o;a++)n=i[a],r+=g[n.action](n,t,e);return r};(t=function(t,e){var i;return t===e?t:(t=n(t),e=n(e),i=a(t,e),w(t,e,i))}).html_to_tokens=n,(t.find_matching_blocks=v).find_match=h,v.create_index=r,t.calculate_operations=a,t.render_operations=w,"function"==typeof define?define([],function(){return t}):"undefined"!=typeof module&&null!==module?module.exports=t:"undefined"!=typeof window&&(window.htmldiff=t)}();